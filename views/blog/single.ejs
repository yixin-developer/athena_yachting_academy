<%
  // declare once at the top
  const p = post;
  const title = p.seometatitle || `${p.title} â€” Athena Yachting Academy`; 
  const description = p.seometadescription || p.excerpt || 'Learn about sailing, RYA courses, and yachting adventures in Greece with Athena Yachting Academy.';
  const imgUrl = p.featuredimage?.url 
    ? `${process.env.CMS_BASE || 'http://localhost:1337'}${p.featuredimage.url}` 
    : null;
  const cats = Array.isArray(p.categories) ? p.categories : [];
%>

<!doctype html>
<html lang="en">
  <head>
    <title><%= title %></title>
    <meta name="description" content="<%= description %>">
    <% if (imgUrl) { %>
      <meta property="og:image" content="<%= imgUrl %>">
    <% } %>
    <meta property="og:title" content="<%= title %>">
    <meta property="og:description" content="<%= description %>">
    <meta property="og:type" content="article">
    <%- include('../partials/header') %>
    <style>
      h1 {
        font-family: 'Playfair Display', serif;
        color: #003366;
        font-size: 3rem;
        font-weight:normal;
        }
      .category-pill {
        background: #003366;
        color: #fff;
        border-radius: 16px;
        padding: 6px 12px;
        font-size: 1rem;
        font-weight: 600;
        text-decoration: none;
        margin-left: 6px;
        box-shadow: 0 2px 6px rgba(0,0,0,.15);
        transition: background .2s ease;
      }
      .category-pill:hover {
        background: #0055a5;
        color: #fff;
        text-decoration: none;
      }
      .badge-stack {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        /* margin-bottom: 1rem; */
      }
      .blog-post-top-image{
        max-height: 500px;
        width: 100%;
        object-fit: cover;
      }
      .blog-content img {
        max-width: 100%;
        height: auto;
        border-radius: 6px;
        margin: 1rem 0;
      }
    </style>
  </head>

  <body>
      <% if (imgUrl) { %>
        <img src="<%= imgUrl %>" alt="<%= p.title %>" class="img-fluid blog-post-top-image rounded shadow-sm">
      <% } %>
    <div class="container py-3">
      <div class="my-5"></div>
      <a href="/new-blog" class="text-decoration-none text-secondary small">&larr; Back to Blog</a>

      <article class="mt-3">

        <% if (cats.length) { %>
          <div class="badge-stack mb-4">
            <p><strong>Category: </strong></p>
            <% cats.slice(0, 3).forEach(c => { %>
              <a class="category-pill"
                href="/new-blog/category/<%= encodeURIComponent(c.Slug || c.slug || c.Name || c.name) %>">
                <%= c.Name || c.name || c.Slug || c.slug %>
              </a>
            <% }) %>
          </div>
        <% } %>


        <h1 class="fw-bold mb-3"><%= p.title %></h1>

        <% if (p.publisheddate) { %>
          <p class="text-muted ">
            <i>Published on <%= new Date(p.publisheddate).toLocaleDateString('en-GB', { year: 'numeric', month: 'long', day: 'numeric' }) %></i>
          </p>
        <% } %>

        <% if (htmlContent) { %>
          <div class="blog-content mb-5">
            <%- htmlContent %>
          </div>
        <% } else { %>
          <p class="text-muted">This post has no content yet.</p>
        <% } %>
      </article>
    </div>

    <%- include('../partials/footer') %>
  </body>
</html>